(this["webpackJsonpreact-mesto-auth"]=this["webpackJsonpreact-mesto-auth"]||[]).push([[0],{30:function(e,t,a){},36:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),o=a(20),r=a.n(o),l=a(6),i=(a(30),a(8)),s=a(24),m=a(1),u=c.a.createContext(),d=c.a.memo((function(e){var t=c.a.useContext(u),a=e.card.owner._id===t._id,n="photo-elements__delete-button ".concat(!a&&"photo-elements__delete-button_hidden"),o=e.card.likes.some((function(e){return e._id===t._id})),r="photo-elements__like-button ".concat(o&&"photo-elements__like-button_active");return c.a.createElement("li",{className:"photo-elements__item"},c.a.createElement("img",{className:"photo-elements__image",src:e.card.link,alt:e.card.name,onClick:function(){e.onCardClick(e.card)}}),c.a.createElement("div",{className:"photo-elements__caption"},c.a.createElement("h2",{className:"photo-elements__text"},e.card.name),c.a.createElement("div",{className:"photo-elements__like-container"},c.a.createElement("button",{className:r,type:"button","aria-label":"\u041d\u0440\u0430\u0432\u0438\u0442\u0441\u044f",onClick:function(){e.onCardLike(e.card)}}),c.a.createElement("p",{className:"photo-elements__like-counter"},e.card.likes.length)),c.a.createElement("button",{className:n,type:"button","aria-label":"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",onClick:function(){e.onCardDelete(e.card)}})))})),p=a.p+"static/media/logo.a307e1c4.svg",h=function(e){var t;return"signin"===e.page?t=c.a.createElement(l.c,{to:"/signup",className:"header__link"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"):"signup"===e.page?t=c.a.createElement(l.c,{to:"/signin",className:"header__link"},"\u0412\u043e\u0439\u0442\u0438"):"feed"===e.page&&(t=c.a.createElement("nav",{className:"header__nav"},c.a.createElement("p",{className:"header__info"},e.userData.email),c.a.createElement(l.c,{to:"/login",className:"header__link header__link_signout",onClick:e.handleSignOut},"\u0412\u044b\u0439\u0442\u0438"))),c.a.createElement("header",{className:"header"},c.a.createElement("img",{src:p,alt:"\u043b\u043e\u0433\u043e\u0442\u0438\u043f \u043c\u0435\u0441\u0442\u043e",className:"header__logo"}),t)},_=function(e){return c.a.createElement("footer",{className:"footer"},c.a.createElement("p",{className:"footer__copyright"},"\xa9 2020 Mesto Russia"))},f=function(e){var t=Object(n.useContext)(u);return c.a.createElement(c.a.Fragment,null,c.a.createElement(h,{page:"feed",handleSignOut:e.handleSignOut,userData:e.userData}),c.a.createElement("main",{className:"main"},c.a.createElement("section",{className:"profile"},c.a.createElement("div",{className:"profile__photo-container",onClick:e.onEditAvatar},c.a.createElement("img",{src:t.avatar,alt:"\u0444\u043e\u0442\u043e \u043f\u0440\u043e\u0444\u0438\u043b\u044f",className:"profile__photo"})),c.a.createElement("div",{className:"profile__info"},c.a.createElement("div",{className:"profile__title"},c.a.createElement("h1",{className:"profile__name"},t.name),c.a.createElement("button",{className:"profile__edit-button",type:"button","aria-label":"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c",onClick:e.onEditProfile})),c.a.createElement("p",{className:"profile__description"},t.about)),c.a.createElement("button",{className:"profile__add-button",type:"button","aria-label":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c",onClick:e.onAddPlace})),c.a.createElement("section",{className:"photo-elements"},c.a.createElement("ul",{className:"photo-elements__list"},e.cards.map((function(t){return c.a.createElement(d,{card:t,key:t._id,onCardClick:e.onCardClick,onCardLike:e.onCardLike,onCardDelete:e.onCardDelete})}))))),c.a.createElement(_,null))},b=function(e){return c.a.createElement("div",{className:"modal ".concat(e.name," ").concat(e.isOpen?"modal_opened":"")},c.a.createElement("div",{className:"modal__container"},c.a.createElement("h2",{className:"modal__title"},e.title),c.a.createElement("form",{action:"#",name:"form-".concat(e.name),className:"modal__form",method:"POST",onSubmit:e.onSubmit},e.children,c.a.createElement("button",{type:"submit",className:"modal__button"},e.submitButtonState)),c.a.createElement("button",{className:"modal__close-button",type:"button","aria-label":"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",onClick:e.onClose})))},E=function(e){var t=Object(n.useContext)(u),a=Object(n.useState)(""),o=Object(m.a)(a,2),r=o[0],l=o[1],i=Object(n.useState)(""),s=Object(m.a)(i,2),d=s[0],p=s[1];return Object(n.useEffect)((function(){l(t.name),p(t.about)}),[t,e.isOpen]),c.a.createElement(b,{name:"edit-modal",title:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0444\u0438\u043b\u044c",submitButtonState:e.submitButtonState,isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onUpdateUser({name:r,about:d})},children:c.a.createElement(c.a.Fragment,null,c.a.createElement("input",{type:"text",name:"profile-name",id:"profile-name-input",placeholder:"\u0412\u0430\u0448\u0435 \u0438\u043c\u044f",className:"modal__input",required:!0,minLength:"2",maxLength:"40",autoComplete:"off",value:r,onChange:function(e){l(e.target.value)}}),c.a.createElement("p",{className:"modal__input-error-message",id:"profile-name-error"}),c.a.createElement("input",{type:"text",name:"profile-job",id:"profile-job-input",placeholder:"\u0412\u0430\u0448\u0430 \u043f\u0440\u043e\u0444\u0435\u0441\u0441\u0438\u044f",className:"modal__input",required:!0,minLength:"2",maxLength:"200",autoComplete:"off",value:d,onChange:function(e){p(e.target.value)}}),c.a.createElement("p",{className:"modal__input-error-message",id:"profile-job-error"}))})},g=function(e){var t=Object(n.useState)(""),a=Object(m.a)(t,2),o=a[0],r=a[1],l=Object(n.useState)(""),i=Object(m.a)(l,2),s=i[0],u=i[1];return c.a.createElement(b,{name:"add-modal",title:"\u041d\u043e\u0432\u043e\u0435 \u043c\u0435\u0441\u0442\u043e",submitButtonState:e.submitButtonState,isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(t){t.preventDefault(),e.onAddPlace({name:o,link:s}),r(""),u("")},children:c.a.createElement(c.a.Fragment,null,c.a.createElement("input",{type:"text",name:"place-name",id:"place-name-input",placeholder:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435",className:"modal__input",required:!0,minLength:"1",maxLength:"30",autoComplete:"off",value:o,onChange:function(e){r(e.target.value)}}),c.a.createElement("p",{className:"modal__input-error-message",id:"place-name-error"}),c.a.createElement("input",{type:"url",name:"place-link",id:"place-link-input",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",className:"modal__input",required:!0,value:s,onChange:function(e){u(e.target.value)}}),c.a.createElement("p",{className:"modal__input-error-message",id:"place-link-error"}))})},v=function(e){var t=Object(n.useRef)();return c.a.createElement(b,{name:"avatar-update-modal",title:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0430\u0432\u0430\u0442\u0430\u0440",submitButtonState:e.submitButtonState,isOpen:e.isOpen,onClose:e.onClose,onSubmit:function(a){a.preventDefault(),e.onUpdateAvatar(t.current.value),t.current.value=""},children:c.a.createElement(c.a.Fragment,null,c.a.createElement("input",{ref:t,type:"url",name:"avatar-link",id:"avatar-link-input",placeholder:"\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",className:"modal__input",required:!0}),c.a.createElement("p",{className:"modal__input-error-message",id:"avatar-link-error"}))})},O=function(e){return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"".concat(e.name," ").concat(e.isOpen?"pic-modal_opened":"")},c.a.createElement("div",{className:"pic-modal__container"},c.a.createElement("figure",{className:"pic-modal__picture"},c.a.createElement("img",{src:e.card.link,alt:e.card.name,className:"pic-modal__image"}),c.a.createElement("figcaption",{className:"pic-modal__caption"},e.card.name)),c.a.createElement("button",{className:"pic-modal__close-button",type:"button","aria-label":"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",onClick:e.onClose}))))},N=a(10),j=function(e){var t=Object(n.useState)({email:"",password:""}),a=Object(m.a)(t,2),o=a[0],r=a[1],l=function(e){var t=e.target,a=t.name,n=t.value;r(Object(i.a)(Object(i.a)({},o),{},Object(N.a)({},a,n)))};return c.a.createElement(c.a.Fragment,null,c.a.createElement(h,{page:"signin"}),c.a.createElement("div",{className:"login"},c.a.createElement("div",{className:"login__containter"},c.a.createElement("h1",{className:"login__title"},"\u0412\u0445\u043e\u0434"),c.a.createElement("form",{onSubmit:function(t){t.preventDefault();var a=o.email,n=o.password;e.handleLogin(a,n)}},c.a.createElement("input",{type:"email",name:"email",className:"login__input",placeholder:"Email",value:o.email,onChange:l}),c.a.createElement("input",{type:"password",name:"password",className:"login__input",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",value:o.password,onChange:l}),c.a.createElement("div",{className:"login__button-containter"},c.a.createElement("button",{type:"submit",className:"login__button"},"\u0412\u043e\u0439\u0442\u0438"))))))},k=a.p+"static/media/signup-modal-result-fail.df8eddf6.svg",C=a.p+"static/media/signup-modal-result-success.1b6082f8.svg",S=function(e){var t,a;return!0===e.signupResult?(t="\u0412\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043b\u0438\u0441\u044c!",a=C):(t="\u0427\u0442\u043e-\u0442\u043e \u043f\u043e\u0448\u043b\u043e \u043d\u0435 \u0442\u0430\u043a! \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0435\u0449\u0451 \u0440\u0430\u0437.",a=k),c.a.createElement("div",{className:"signup-modal ".concat(e.isOpen?"signup-modal_opened":"")},c.a.createElement("div",{className:"signup-modal__container"},c.a.createElement("img",{src:a,alt:"\u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0430 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u0430",className:"signup-modal__img"}),c.a.createElement("p",{className:"signup-modal__text"},t),c.a.createElement("button",{className:"signup-modal__close-button",onClick:e.onClose})))},y=function(e){var t=Object(n.useState)({email:"",password:""}),a=Object(m.a)(t,2),o=a[0],r=a[1],s=function(e){var t=e.target,a=t.name,n=t.value;r(Object(i.a)(Object(i.a)({},o),{},Object(N.a)({},a,n)))};return c.a.createElement(c.a.Fragment,null,c.a.createElement(h,{page:"signup"}),c.a.createElement("div",{className:"login"},c.a.createElement("div",{className:"login__containter"},c.a.createElement("h1",{className:"login__title"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),c.a.createElement("form",{onSubmit:function(t){t.preventDefault();var a=o.email,n=o.password;e.handleSignup(a,n)},className:"login__form"},c.a.createElement("input",{id:"email",name:"email",type:"email",className:"login__input",placeholder:"Email",value:o.email,onChange:s}),c.a.createElement("input",{id:"password",name:"password",type:"password",className:"login__input",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c",value:o.password,onChange:s}),c.a.createElement("button",{type:"submit",className:"login__button"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f"))),c.a.createElement("div",{className:"login__button-containter"},c.a.createElement("div",{className:"login__button-caption"},c.a.createElement("span",null,"\u0423\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b?"),c.a.createElement(l.b,{to:"/signin",className:"login__link"},"\u0412\u043e\u0439\u0442\u0438")))),c.a.createElement(S,{signupResult:e.signupResult,isOpen:e.isSignupModalOpen,onClose:e.onClose}))},w=a(25),P=a(2),T=function(e){var t=e.component,a=Object(w.a)(e,["component"]);return c.a.createElement(c.a.Fragment,null,c.a.createElement(P.b,null,(function(){return a.loggedIn?c.a.createElement(t,a):c.a.createElement(P.a,{to:"/login"})})))},x=a(22),A=a(23),L=new(function(){function e(t){var a=t.url,n=t.headers;Object(x.a)(this,e),this._url=a,this._headers=n}return Object(A.a)(e,[{key:"_checkErrors",value:function(e){return e.ok?e.json():Promise.reject("Something is wrong: 4 8 15 16 23 42 && ".concat(e.status," ").concat(e.statusText))}},{key:"getProfileInfo",value:function(){return fetch("".concat(this._url,"/users/me"),{method:"GET",headers:this._headers}).then(this._checkErrors)}},{key:"getCards",value:function(){return fetch("".concat(this._url,"/cards"),{method:"GET",headers:this._headers}).then(this._checkErrors)}},{key:"editProfile",value:function(e){return fetch("".concat(this._url,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkErrors)}},{key:"updateAvatar",value:function(e){return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkErrors)}},{key:"addCard",value:function(e){var t=e.name,a=e.link;return fetch("".concat(this._url,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:a})}).then(this._checkErrors)}},{key:"removeCard",value:function(e){return fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._checkErrors)}},{key:"changeLikeCardStatus",value:function(e,t){return t?fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then(this._checkErrors):fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then(this._checkErrors)}}]),e}())({url:"https://mesto.nomoreparties.co/v1/cohort-15",headers:{authorization:"1ed91742-56fd-4a56-812b-580db32d6be2","Content-Type":"application/json"}}),D="https://auth.nomoreparties.co",B=function(e){return e.ok?e.json():Promise.reject("\u041e\u0448\u0438\u0431\u043a\u0430: ".concat(e.status))},F=function(){var e=Object(n.useState)({name:"",about:"",avatar:""}),t=Object(m.a)(e,2),a=t[0],o=t[1],r=Object(n.useState)(!1),l=Object(m.a)(r,2),d=l[0],p=l[1],h=Object(n.useState)({email:""}),_=Object(m.a)(h,2),b=_[0],N=_[1],k=Object(n.useState)(!1),C=Object(m.a)(k,2),S=C[0],w=C[1],x=Object(n.useState)("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),A=Object(m.a)(x,2),F=A[0],I=A[1],J=Object(n.useState)(!1),U=Object(m.a)(J,2),q=U[0],R=U[1],M=Object(n.useState)({}),G=Object(m.a)(M,2),z=G[0],H=G[1],K=Object(n.useState)([]),Q=Object(m.a)(K,2),V=Q[0],W=Q[1],X=Object(n.useState)(!1),Y=Object(m.a)(X,2),Z=Y[0],$=Y[1],ee=Object(n.useState)("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),te=Object(m.a)(ee,2),ae=te[0],ne=te[1],ce=Object(n.useState)(!1),oe=Object(m.a)(ce,2),re=oe[0],le=oe[1],ie=Object(n.useState)("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"),se=Object(m.a)(ie,2),me=se[0],ue=se[1],de=function(){w(!1),$(!1),le(!1),R(!1)},pe=Object(P.g)(),he=Object(n.useState)(!1),_e=Object(m.a)(he,2),fe=_e[0],be=_e[1],Ee=Object(n.useState)(!1),ge=Object(m.a)(Ee,2),ve=ge[0],Oe=ge[1],Ne=function(){var e,t=localStorage.getItem("jwt");t&&(e=t,fetch("".concat(D,"/users/me"),{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then(B)).then((function(e){e&&(N({email:e.email}),p(!0),pe.push("/feed"))})).catch((function(e){return console.error(e)}))};return Object(n.useEffect)((function(){Promise.all([L.getProfileInfo(),L.getCards()]).then((function(e){var t=Object(m.a)(e,2),a=t[0],n=t[1];o(a),W(n)})).catch((function(e){return console.error(e)})),Ne()}),[]),c.a.createElement(u.Provider,{value:a},c.a.createElement(P.d,null,c.a.createElement(P.b,{exact:!0,path:"/signin"},c.a.createElement(j,{handleLogin:function(e,t){(function(e,t){return fetch("".concat(D,"/signin"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:t,email:e})}).then(B)})(e,t).then((function(t){t.token&&(localStorage.setItem("jwt",t.token),N({email:e}),p(!0),pe.push("/feed"))})).catch((function(e){return console.error(e)}))}})),c.a.createElement(P.b,{exact:!0,path:"/signup"},c.a.createElement(y,{handleSignup:function(e,t){(function(e,t){return fetch("".concat(D,"/signup"),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({password:t,email:e})}).then(B)})(e,t).then((function(){Oe(!0),be(!0)})).catch((function(e){be(!0),console.error(e)}))},signupResult:ve,isSignupModalOpen:fe,onClose:function(){ve?(be(!1),pe.push("/signin")):be(!1)}})),c.a.createElement(T,{path:"/feed",component:f,loggedIn:d,userData:b,onEditProfile:function(){w(!0)},onAddPlace:function(){$(!0)},onEditAvatar:function(){le(!0)},onCardClick:function(e){H(e),R(!0)},cards:V,onCardLike:function(e){var t=e.likes.some((function(e){return e._id===a._id}));L.changeLikeCardStatus(e._id,t).then((function(t){var a=V.map((function(a){return a._id===e._id?t:a}));W(a)})).catch((function(e){return console.error(e)}))},onCardDelete:function(e){L.removeCard(e._id).then((function(){var t=V.filter((function(t){return t._id!==e._id}));W(t)})).catch((function(e){return console.error(e)}))},handleSignOut:function(){localStorage.removeItem("jwt"),N({email:""}),p(!1)}}),c.a.createElement(P.b,{exact:!0,path:"/"},d?c.a.createElement(P.a,{to:"/feed"}):c.a.createElement(P.a,{to:"/signin"})),c.a.createElement(P.b,{path:"/*"},d?c.a.createElement(P.a,{to:"/feed"}):c.a.createElement(P.a,{to:"/signin"}))),c.a.createElement(E,{isOpen:S,onClose:de,onUpdateUser:function(e){I("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."),L.editProfile(e).then((function(e){o(e),de()})).catch((function(e){return console.error(e)})).finally((function(){I("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c")}))},submitButtonState:F}),c.a.createElement(g,{isOpen:Z,onClose:de,onAddPlace:function(e){ne("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."),L.addCard({name:e.name,link:e.link}).then((function(e){W([e].concat(Object(s.a)(V))),de()})).catch((function(e){return console.error(e)})).finally((function(){ne("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c")}))},submitButtonState:ae}),c.a.createElement(v,{isOpen:re,onClose:de,onUpdateAvatar:function(e){ue("\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435..."),L.updateAvatar(e).then((function(e){o(Object(i.a)(Object(i.a)({},a),{},{avatar:e.avatar})),de()})).catch((function(e){return console.error(e)})).finally((function(){ue("\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c")}))},submitButtonState:me}),c.a.createElement(O,{name:"pic-modal",isOpen:q,onClose:de,card:z}))};r.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(l.a,null,c.a.createElement(F,null))),document.querySelector("#root"))}},[[36,1,2]]]);
//# sourceMappingURL=main.e38ad841.chunk.js.map